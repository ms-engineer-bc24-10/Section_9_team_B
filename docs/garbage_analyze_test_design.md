# テスト設計書: analyze_garbage 関数

## 1. 概要

Google Vision API を利用した画像解析関数 `analyze_garbage` が、以下の要件を満たして正しく動作するかを確認します。

- ゴミ袋および関連オブジェクトの検出
- ラベル情報の取得
- ゴミ袋の面積とポイントの算出

## 2. テスト対象

### 対象モジュール

- `garbage_analysis.google_vision`

### 対象関数

- `analyze_garbage(image_path: str) -> dict`

---

## 3. テスト目的

1. 関数が正確にゴミ袋や関連するラベルを検出することを確認します。
2. 面積とポイントが正しく算出されることを確認します。
3. 異常系の入力に対して適切なエラー処理が行われることを確認します。

---

## 4. 前提条件

- Google Vision API の認証情報が正しく設定されていること。
- モックを使用してテストが外部依存なしで実行可能であること。
- テスト環境に必要なモジュール（`unittest`, `unittest.mock` など）がインストールされていること。

---

## 5. テスト項目

| **テスト ID** | **テスト内容**                                                             | **期待結果**                       |
| ------------- | -------------------------------------------------------------------------- | ---------------------------------- |
| T001          | ゴミ袋（`plastic bag`）が適切に検出されるか確認                            | `garbage_bag_detected=True`        |
| T002          | 検出されたラベルに `plastic bag` と `bottle` が含まれるか確認              | `labels=['plastic bag', 'bottle']` |
| T003          | ゴミ袋の面積が計算され、その結果に基づいてポイントが適切に算出されるか確認 | 面積が計算され、`points > 0`       |

---

## 6. テスト手順

1. **モックの設定**:

   - `open` 関数をモックして、画像データ（`b"dummy image data"`）を返すように設定します。
   - `ImageAnnotatorClient` をモックして、以下のレスポンスを返すように設定します。
     - ラベル: `plastic bag` と `bottle`
     - オブジェクト: `bag`

2. **関数の実行**:

   - 関数 `analyze_garbage` をダミーパス（`"dummy_path"`）で実行します。

3. **結果の検証**:
   - `garbage_bag_detected` が `True` であることを確認します。
   - ラベルリストに `plastic bag` と `bottle` が含まれることを確認します。
   - 算出されたポイントが 0 より大きいことを確認します。

---

## 7. テストデータ

| **テストデータ** | **内容**                                                                                     |
| ---------------- | -------------------------------------------------------------------------------------------- |
| `dummy_path`     | ファイルパスの代わりに使用するダミーデータ（`open`関数のモックにより、実際のファイルは不要） |

---
